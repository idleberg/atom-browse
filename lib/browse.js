"use strict";var e=require("atom"),t=require("path"),n=require("fs"),r=require("os"),o=require("util"),i=require("electron"),a=require("child_process");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=s(t),u=s(n),l=s(o);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function d(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function m(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}const h=()=>{const e=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const t=(new Error).stack.slice(1);return Error.prepareStackTrace=e,t};var v=h,y=h;v.default=y;var g=m((function(e,t){var n=p&&p.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},r=p&&p.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.readManifestSync=t.readManifest=void 0;var o=c.default.resolve,i=c.default.sep,a=u.default.promises,s=u.default.readFileSync;function l(e){e=(null==e?void 0:e.length)?e:function(){var e=(({depth:e=0}={})=>{const t=[],n=new Set;for(const r of v()){const o=r.getFileName(),i=null!==r.getTypeName()&&null!==o;if(n.has(o)||(n.add(o),t.unshift(r)),i)return t[e]}})().getFileName(),t=atom.packages.getPackageDirPaths().filter((function(t){return e.startsWith(t)}));if(null==t?void 0:t.length)return e.replace(t[0],"").split(i).filter((function(e){return e}))[0]||"";return""}();var t=atom.packages.resolvePackagePath(e);return o(t,"package.json")}t.readManifest=function(e){return void 0===e&&(e=""),n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:t=l(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.readFile(t,"utf8")];case 2:return n=r.sent(),[2,JSON.parse(n)];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},t.readManifestSync=function(e){void 0===e&&(e="");var t=l(e);try{var n=s(t,"utf8");return JSON.parse(n)}catch(e){return null}}})),w=m((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.warn=t.trace=t.timeStamp=t.timeLog=t.timeEnd=t.time=t.table=t.profileEnd=t.profile=t.log=t.info=t.groupEnd=t.groupCollapsed=t.group=t.error=t.dirxml=t.dir=t.debug=t.countReset=t.count=t.context=t.clear=t.assert=void 0;const n=g.readManifestSync(),r=["table"];function o(e,...t){if(null===atom||void 0===atom?void 0:atom.inDevMode())return r.includes(e)||t.unshift(`[${n.name}]`),p.console[e](...t)}t.assert=function(...e){return o("assert",...e)},t.clear=function(...e){return o("clear",...e)},t.context=function(...e){return o("context",...e)},t.count=function(...e){return o("count",...e)},t.countReset=function(...e){return o("countReset",...e)},t.debug=function(...e){return o("debug",...e)},t.dir=function(...e){return o("dir",...e)},t.dirxml=function(...e){return o("dirxml",...e)},t.error=function(...e){return o("error",...e)},t.group=function(...e){return o("group",...e)},t.groupCollapsed=function(...e){return o("groupCollapsed",...e)},t.groupEnd=function(...e){return o("groupEnd",...e)},t.info=function(...e){return o("info",...e)},t.log=function(...e){return o("log",...e)},t.profile=function(...e){return o("profile",...e)},t.profileEnd=function(...e){return o("profileEnd",...e)},t.table=function(...e){return o("table",...e)},t.time=function(...e){return o("time",...e)},t.timeEnd=function(...e){return o("timeEnd",...e)},t.timeLog=function(...e){return o("timeLog",...e)},t.timeStamp=function(...e){return o("timeStamp",...e)},t.trace=function(...e){return o("trace",...e)},t.warn=function(...e){return o("warn",...e)}})),b={notify:{title:"Notifications",description:"Specify which types of notifications to display",type:"string",enum:[{value:"none",description:"None"},{value:"warnings",description:"Warnings Only"},{value:"all",description:"All Notifications"}],default:"all",order:1},dependencyPaths:{title:"Dependency Paths",description:"Specify dependency folders that can be opened using the *Browse: Dependency Folders* command",type:"array",default:["bower_components","node_modules","vendor"],items:{type:["string"]},order:2},beep:{title:"Beep on error",description:"Play beep sound when errors occur",type:"boolean",default:!0,order:3},openAppPackage:function(){if("darwin"===r.platform()){var e=void 0;switch(atom.getReleaseChannel()){case"beta":e="Atom Beta";break;case"nightly":e="Atom Nightly";break;default:e="Atom"}return{title:"Open App Package",description:"Specify whether *Browse: Application Folder* opens the `"+e+".app` package or the executable that started the Node.js process (i.e. `Atom Helper`)",type:"boolean",default:!0,order:3}}return{}}(),customFileManager:{title:"Custom File Manager Options",type:"object",order:5,properties:{fullPath:{title:"Full Path",description:"Specify the full path to a custom file manager",type:"string",default:"",order:1},openArgs:{title:"Open Arguments",description:"Specify custom arguments to open a folder. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:2},revealArgs:{title:"Reveal Arguments",description:"Specify custom arguments to reveal a file. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:3}}}},k=o.promisify(a.spawn),P=function(e){return void 0===e&&(e=""),atom.config.get("browse."+e)},x=function(){switch(r.platform()){case"darwin":return"Finder";case"win32":return"Explorer";default:return"file manager"}},S=function(e,t){return d(void 0,void 0,void 0,(function(){var r,o,a,s;return f(this,(function(c){switch(c.label){case 0:return(r=!t.length)?[3,2]:[4,(u=t,d(void 0,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n.promises.stat(u)];case 1:return e=t.sent(),[3,3];case 2:return t.sent(),w.warn("Skipping '"+u+"' – not found"),[2,!1];case 3:return[2,e.isDirectory()]}}))})))];case 1:r=!c.sent(),c.label=2;case 2:return r||((o=P("customFileManager.fullPath"))?((a=P("customFileManager.openArgs")).length>0?a.includes("%path%")?(s=a.indexOf("%path%"),a[s]=a[s].replace("%path%",t)):a.push(t):a=[t],E("Opening "+e+" in custom file manager"),k(o,a,{})):(E("Opening "+e+" in "+x()),i.shell.openItem(t))),[2]}var u}))}))},A=function(e){return d(void 0,void 0,void 0,(function(){var r,o,a,s;return f(this,(function(c){switch(c.label){case 0:return(r=!e.length)?[3,2]:[4,(u=e,d(void 0,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n.promises.access(u,n.constants.F_OK)];case 1:return e.sent(),[3,3];case 2:return e.sent(),w.warn("Skipping '"+u+"' – not found"),[2,!1];case 3:return[2,!0]}}))})))];case 1:r=!c.sent(),c.label=2;case 2:return r||((o=P("customFileManager.fullPath"))?((a=P("customFileManager.revealArgs")).length>0?a.includes("%path%")?(s=a.indexOf("%path%"),a[s]=a[s].replace("%path%",e)):a.push(e):a=[e],E("Revealing `"+t.basename(e)+"` in custom file manager"),k(o,a,{})):(E("Revealing `"+t.basename(e)+"` in "+x()),i.shell.showItemInFolder(e))),[2]}var u}))}))},E=function(e,t){void 0===t&&(t=!1),"all"===P("notify")&&atom.notifications.addInfo("**browse**: "+e,{dismissable:t,icon:"check"}),w.info(""+e)},F=function(e,t){void 0===t&&(t=!1),"none"!==P("notify")&&atom.notifications.addWarning("**browse**: "+e,{dismissable:t}),P("beep")&&atom.beep(),w.warn(""+e)};const O=(e,...t)=>new Promise(n=>{n(e(...t))});var j=O,T=O;j.default=T;var D=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=[];let n=0;const r=async(e,r,...o)=>{n++;const i=j(e,...o);r(i);try{await i}catch{}n--,t.length>0&&t.shift()()},o=(o,...i)=>new Promise(a=>((o,i,...a)=>{t.push(r.bind(null,o,i,...a)),(async()=>{await Promise.resolve(),n<e&&t.length>0&&t.shift()()})()})(o,a,...i));return Object.defineProperties(o,{activeCount:{get:()=>n},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),o};class M extends Error{constructor(e){super(),this.value=e}}const N=async(e,t)=>t(await e),_=async e=>{const t=await Promise.all(e);if(!0===t[1])throw new M(t[0]);return!1};var C=async(e,t,n)=>{n={concurrency:1/0,preserveOrder:!0,...n};const r=D(n.concurrency),o=[...e].map(e=>[e,r(N,e,t)]),i=D(n.preserveOrder?1:1/0);try{await Promise.all(o.map(e=>i(_,e)))}catch(e){if(e instanceof M)return e.value;throw e}};const{promisify:I}=l.default,R=I(u.default.stat),q=I(u.default.lstat),B={directory:"isDirectory",file:"isFile"};function W({type:e}){if(!(e in B))throw new Error("Invalid type specified: "+e)}const L=(e,t)=>void 0===e||t[B[e]]();var U=async(e,t)=>{W(t={cwd:process.cwd(),type:"file",allowSymlinks:!0,...t});const n=t.allowSymlinks?R:q;return C(e,async e=>{try{const r=await n(c.default.resolve(t.cwd,e));return L(t.type,r)}catch{return!1}},t)};U.sync=(e,t)=>{W(t={cwd:process.cwd(),allowSymlinks:!0,type:"file",...t});const n=t.allowSymlinks?u.default.statSync:u.default.lstatSync;for(const r of e)try{const e=n(c.default.resolve(t.cwd,r));if(L(t.type,e))return r}catch{}};const{promisify:G}=l.default,J=G(u.default.access);var H=async e=>{try{return await J(e),!0}catch(e){return!1}};H.sync=e=>{try{return u.default.accessSync(e),!0}catch(e){return!1}};var K=m((function(e){const t=Symbol("findUp.stop");e.exports=async(e,n={})=>{let r=c.default.resolve(n.cwd||"");const{root:o}=c.default.parse(r),i=[].concat(e),a=async t=>{if("function"!=typeof e)return U(i,t);const n=await e(t.cwd);return"string"==typeof n?U([n],t):n};for(;;){const e=await a({...n,cwd:r});if(e===t)return;if(e)return c.default.resolve(r,e);if(r===o)return;r=c.default.dirname(r)}},e.exports.sync=(e,n={})=>{let r=c.default.resolve(n.cwd||"");const{root:o}=c.default.parse(r),i=[].concat(e),a=t=>{if("function"!=typeof e)return U.sync(i,t);const n=e(t.cwd);return"string"==typeof n?U.sync([n],t):n};for(;;){const e=a({...n,cwd:r});if(e===t)return;if(e)return c.default.resolve(r,e);if(r===o)return;r=c.default.dirname(r)}},e.exports.exists=H,e.exports.sync.exists=H.sync,e.exports.stop=t})),Q=function(e){if(!["open","reveal"].includes(e.action))return w.warn("Action '"+e.action+"' is not supported");(Array.isArray(e.target)?e.target:[e.target]).map((function(n){"string"!=typeof n&&w.warn("Skipping: '"+n+"' is not a string"),"reveal"===e.action?A(n):S(t.basename(n),n)}))},$=function(){atom.packages.getPackageDirPaths().filter((function(e){return!e.includes("app.asar")})).map((function(e){S("Packages Folder",e)}))},z=function(e){return d(void 0,void 0,void 0,(function(){var t,n;return f(this,(function(r){return!(t=e||(atom.workspace.getActiveTextEditor()||atom.workspace.getActivePaneItem()))||"TextEditor"!==t.constructor.name&&"ImageEditor"!==t.constructor.name?F("Active pane is not an editor"):(n=t.buffer.file?t.buffer.file.path:"")?A(n):F("File hasn't been saved yet"),[2]}))}))},V={config:b,subscriptions:null,activate:function(){return d(this,void 0,void 0,(function(){return f(this,(function(n){return w.log("Activating package"),this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:.apm-folder":function(){return e=t.dirname(atom.config.getUserConfigPath()),n=t.resolve(e,".apm"),void S(".apm Folder",n);var e,n}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:application-folder":function(){return d(void 0,void 0,void 0,(function(){var e,n,o;return f(this,(function(i){return e=t.dirname(t.resolve(process.execPath)),"darwin"===r.platform()&&P("openAppPackage")?(o=K.sync("Resources",{cwd:e,type:"directory"}),n=o?t.dirname(o):e):n=e,S("Application Folder",n),[2]}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:configuration-folder":function(){return e=t.dirname(atom.config.getUserConfigPath()),void S("Configuration Folder",e);var e}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:app-data-folder":function(){return d(void 0,void 0,void 0,(function(){var e;return f(this,(function(n){switch(r.platform()){case"darwin":e=t.resolve(r.homedir(),"Library","Application Support","Atom");break;case"win32":e=process.env.APPDATA?t.resolve(process.env.APPDATA,"Atom"):"";break;default:e=t.resolve(r.homedir(),".config","Atom")}return S("App Data Folder",e),[2]}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:packages-folder":function(){return $()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-folders":function(){return d(void 0,void 0,void 0,(function(){var e;return f(this,(function(t){return 0===(e=atom.project.getPaths()).length?[2,F("Editor has no projects")]:(e.map((function(e){e.startsWith("atom://")||S("Project Folder",e)})),[2])}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-dependencies":function(){return d(void 0,void 0,void 0,(function(){var e,n;return f(this,(function(r){return 0===(e=atom.project.getPaths()).length?[2,F("Editor has no projects")]:(n=P("dependencyPaths"))&&n.length?(e.map((function(e){e.startsWith("atom://")||n.map((function(n){return d(void 0,void 0,void 0,(function(){var r;return f(this,(function(o){return r=t.resolve(e,n),S("`"+n+"`",r),[2]}))}))}))})),[2]):[2,F("No dependency folders specified in package configuration")]}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:resources-folder":function(){return d(void 0,void 0,void 0,(function(){var e;return f(this,(function(t){return e=atom.commandInstaller.getResourcesDirectory(),S("Resources Folder",e),[2]}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-open-files":function(){var e;(e=atom.workspace.getPaneItems()).length?e.map((function(e){z(e)})):F("No active files")}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-file":function(){return z()}})),[2]}))}))},deactivate:function(){w.log("Deactivating package"),this.subscriptions&&this.subscriptions.dispose()},provideBrowse:function(){return w.log("Providing service"),Q}};module.exports=V;
//# sourceMappingURL=browse.js.map
