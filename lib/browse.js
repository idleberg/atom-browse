"use strict";var e=require("atom"),t=require("os"),n=require("path"),r=require("fs"),o=require("util"),a=require("electron"),i=require("child_process");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=s(n),u=s(r),l=s(o);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function p(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function f(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}function h(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(null===atom||void 0===atom?void 0:atom.inDevMode())return(t=global.console)[e].apply(t,n)}function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return h.apply(void 0,f(["error"],e))}function v(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return h.apply(void 0,f(["log"],e))}function g(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return h.apply(void 0,f(["warn"],e))}var y={notify:{title:"Notifications",description:"Specify which types of notifications to display",type:"string",enum:[{value:"none",description:"None"},{value:"warnings",description:"Warnings Only"},{value:"all",description:"All Notifications"}],default:"all",order:1},dependencyPaths:{title:"Dependency Paths",description:"Specify dependency folders that can be opened using the *Browse: Dependency Folders* command",type:"array",default:["bower_components","node_modules","vendor"],items:{type:["string"]},order:2},beep:{title:"Beep on error",description:"Play beep sound when errors occur",type:"boolean",default:!0,order:3},openAppPackage:function(){if("darwin"===t.platform()){var e=void 0;switch(atom.getReleaseChannel()){case"beta":e="Atom Beta";break;case"nightly":e="Atom Nightly";break;default:e="Atom"}return{title:"Open App Package",description:"Specify whether *Browse: Application Folder* opens the `"+e+".app` package or the executable that started the Node.js process (i.e. `Atom Helper`)",type:"boolean",default:!0,order:3}}return{}}(),customFileManager:{title:"Custom File Manager Options",type:"object",order:5,properties:{fullPath:{title:"Full Path",description:"Specify the full path to a custom file manager",type:"string",default:"",order:1},openArgs:{title:"Open Arguments",description:"Specify custom arguments to open a folder. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:2},revealArgs:{title:"Reveal Arguments",description:"Specify custom arguments to reveal a file. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:3}}}},w=o.promisify(i.spawn);function b(e){return p(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,r.promises.access(e,r.constants.F_OK)];case 1:return t.sent(),[3,3];case 2:return t.sent(),g("[browse] Skipping '"+e+"' – not found"),[2,!1];case 3:return[2,!0]}}))}))}function k(e){return p(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,r.promises.lstat(e)];case 1:return t=n.sent(),[3,3];case 2:return m("[browse]",n.sent()),[2,!1];case 3:return[2,t.isDirectory()]}}))}))}function A(e){return p(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,r.promises.lstat(e)];case 1:return t=n.sent(),[3,3];case 2:return m("[browse]",n.sent()),[2,!1];case 3:return[2,t.isFile()]}}))}))}function P(e){return p(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,r.promises.stat(e)];case 1:return t=n.sent(),[3,3];case 2:return n.sent(),g("[browse] Skipping '"+e+"' – not found"),[2,!1];case 3:return[2,t.isDirectory()]}}))}))}var x=function(e){return void 0===e&&(e=""),atom.config.get("browse."+e)},S=function(){switch(t.platform()){case"darwin":return"Finder";case"win32":return"Explorer";default:return"file manager"}};function F(e){return p(this,void 0,void 0,(function(){var t,n,r,o;return d(this,(function(i){switch(i.label){case 0:return(t=!e.path.length)?[3,2]:[4,P(e.path)];case 1:t=!i.sent(),i.label=2;case 2:return t||((n=x("customFileManager.fullPath"))?((r=x("customFileManager.openArgs")).length>0?r.includes("%path%")?(o=r.indexOf("%path%"),r[o]=r[o].replace("%path%",e.path)):r.push(e.path):r=[e.path],e.silent||D(e.message?String(e.message):"**browse**: Opening '"+e.name+"' in custom file manager"),w(n,r,{})):(e.silent||D(e.message?String(e.message):"**browse**: Opening '"+e.name+"' in "+S()),a.shell.openItem(e.path))),[2]}}))}))}function _(e){return p(this,void 0,void 0,(function(){var t,r,o,i;return d(this,(function(s){switch(s.label){case 0:return(t=!e.path.length)?[3,2]:[4,b(e.path)];case 1:t=!s.sent(),s.label=2;case 2:return t||((r=x("customFileManager.fullPath"))?((o=x("customFileManager.revealArgs")).length>0?o.includes("%path%")?(i=o.indexOf("%path%"),o[i]=o[i].replace("%path%",e.path)):o.push(e.path):o=[e.path],e.silent||D(e.message?String(e.message):"**browse**: Revealing `"+n.basename(e.path)+"` in custom file manager"),w(r,o,{})):(e.silent||D(e.message?String(e.message):"**browse**: Revealing `"+n.basename(e.path)+"` in "+S()),a.shell.showItemInFolder(e.path))),[2]}}))}))}function D(e,t){void 0===t&&(t=!1),"all"===x("notify")&&atom.notifications.addInfo(e,{dismissable:t,icon:"check"}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];h.apply(void 0,f(["info"],e))}("[browse] "+e)}function q(e,t){void 0===t&&(t=!1),"none"!==x("notify")&&atom.notifications.addWarning(e,{dismissable:t}),x("beep")&&atom.beep(),g("[browse] "+e)}class O{constructor(e){this.value=e,this.next=void 0}}class j{constructor(){this.clear()}enqueue(e){const t=new O(e);this._head?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t),this._size++}dequeue(){const e=this._head;if(e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}}var E=j;var I=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new E;let n=0;const r=async(e,r,...o)=>{n++;const a=(async()=>e(...o))();r(a);try{await a}catch{}n--,t.size>0&&t.dequeue()()},o=(o,...a)=>new Promise((i=>{((o,a,...i)=>{t.enqueue(r.bind(null,o,a,...i)),(async()=>{await Promise.resolve(),n<e&&t.size>0&&t.dequeue()()})()})(o,i,...a)}));return Object.defineProperties(o,{activeCount:{get:()=>n},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),o};class z extends Error{constructor(e){super(),this.value=e}}const C=async(e,t)=>t(await e),N=async e=>{const t=await Promise.all(e);if(!0===t[1])throw new z(t[0]);return!1};var T=async(e,t,n)=>{n={concurrency:1/0,preserveOrder:!0,...n};const r=I(n.concurrency),o=[...e].map((e=>[e,r(C,e,t)])),a=I(n.preserveOrder?1:1/0);try{await Promise.all(o.map((e=>a(N,e))))}catch(e){if(e instanceof z)return e.value;throw e}};const{promisify:M}=l.default,R=M(u.default.stat),B=M(u.default.lstat),W={directory:"isDirectory",file:"isFile"};function U({type:e}){if(!(e in W))throw new Error(`Invalid type specified: ${e}`)}const G=(e,t)=>void 0===e||t[W[e]]();var H=async(e,t)=>{U(t={cwd:process.cwd(),type:"file",allowSymlinks:!0,...t});const n=t.allowSymlinks?R:B;return T(e,(async e=>{try{const r=await n(c.default.resolve(t.cwd,e));return G(t.type,r)}catch{return!1}}),t)};H.sync=(e,t)=>{U(t={cwd:process.cwd(),allowSymlinks:!0,type:"file",...t});const n=t.allowSymlinks?u.default.statSync:u.default.lstatSync;for(const r of e)try{const e=n(c.default.resolve(t.cwd,r));if(G(t.type,e))return r}catch{}};const{promisify:K}=l.default,L=K(u.default.access);var Q=async e=>{try{return await L(e),!0}catch(e){return!1}};Q.sync=e=>{try{return u.default.accessSync(e),!0}catch(e){return!1}};var $=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){const t=Symbol("findUp.stop");e.exports=async(e,n={})=>{let r=c.default.resolve(n.cwd||"");const{root:o}=c.default.parse(r),a=[].concat(e),i=async t=>{if("function"!=typeof e)return H(a,t);const n=await e(t.cwd);return"string"==typeof n?H([n],t):n};for(;;){const e=await i({...n,cwd:r});if(e===t)return;if(e)return c.default.resolve(r,e);if(r===o)return;r=c.default.dirname(r)}},e.exports.sync=(e,n={})=>{let r=c.default.resolve(n.cwd||"");const{root:o}=c.default.parse(r),a=[].concat(e),i=t=>{if("function"!=typeof e)return H.sync(a,t);const n=e(t.cwd);return"string"==typeof n?H.sync([n],t):n};for(;;){const e=i({...n,cwd:r});if(e===t)return;if(e)return c.default.resolve(r,e);if(r===o)return;r=c.default.dirname(r)}},e.exports.exists=Q,e.exports.sync.exists=Q.sync,e.exports.stop=t}));function J(e){return p(this,void 0,void 0,(function(){var t,r=this;return d(this,(function(o){switch(o.label){case 0:return"string"!=typeof e?[3,2]:(v("[browse] Auto-handle string input"),t={},[4,A(e)]);case 1:t.action=o.sent()?"reveal":"open",t.target=e,e=t,o.label=2;case 2:return(Array.isArray(e.target)?e.target:[e.target]).map((function(t){return p(r,void 0,void 0,(function(){var r,o,a;return d(this,(function(i){switch(i.label){case 0:return"string"!=typeof t&&g("[browse] Skipping: target path is of type "+typeof t+", should be string"),(r="reveal"===e.action)?[3,2]:[4,A(t)];case 1:r=i.sent(),i.label=2;case 2:return r?(_({path:t,message:e.message,silent:e.silent}),[3,6]):[3,3];case 3:return(o="open"===e.action)?[3,5]:[4,k(t)];case 4:o=i.sent(),i.label=5;case 5:o?F({name:n.basename(t),path:t,message:e.message,silent:e.silent}):(null===(a=e.action)||void 0===a?void 0:a.length)&&g("[browse] Action '"+e.action+"' is not supported"),i.label=6;case 6:return[2]}}))}))})),[2]}}))}))}function V(){atom.packages.getPackageDirPaths().filter((function(e){return!e.includes("app.asar")})).map((function(e){F({name:"Packages Folder",path:e})}))}function X(e){return p(this,void 0,void 0,(function(){var t,n;return d(this,(function(r){return!(t=e||(atom.workspace.getActiveTextEditor()||atom.workspace.getActivePaneItem()))||"TextEditor"!==t.constructor.name&&"ImageEditor"!==t.constructor.name?q("Active pane is not an editor"):(n=t.buffer.file?t.buffer.file.path:"")?_({path:n}):q("File hasn't been saved yet"),[2]}))}))}var Y={config:y,subscriptions:new e.CompositeDisposable,activate:function(){return p(this,void 0,void 0,(function(){return d(this,(function(e){return v("[browse] Activating package"),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:.apm-folder":function(){return e=n.dirname(atom.config.getUserConfigPath()),void F({name:".apm Folder",path:n.resolve(e,".apm")});var e}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:application-folder":function(){return function(){return p(this,void 0,void 0,(function(){var e,r,o;return d(this,(function(a){return e=n.dirname(n.resolve(process.execPath)),"darwin"===t.platform()&&x("openAppPackage")?(o=$.sync("Resources",{cwd:e,type:"directory"}),r=o?n.dirname(o):e):r=e,F({name:"Application Folder",path:r}),[2]}))}))}()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:configuration-folder":function(){F({name:"Configuration Folder",path:n.dirname(atom.config.getUserConfigPath())})}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:app-data-folder":function(){return function(){var e;switch(t.platform()){case"darwin":e=n.resolve(t.homedir(),"Library","Application Support","Atom");break;case"win32":e=process.env.APPDATA?n.resolve(process.env.APPDATA,"Atom"):"";break;default:e=n.resolve(t.homedir(),".config","Atom")}F({name:"App Data Folder",path:e})}()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:packages-folder":function(){return V()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-folders":function(){return function(){return p(this,void 0,void 0,(function(){var e;return d(this,(function(t){return 0===(e=atom.project.getPaths()).length?[2,q("Editor has no projects")]:(e.map((function(e){e.startsWith("atom://")||F({name:"Project Folder",path:e})})),[2])}))}))}()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-dependencies":function(){return function(){return p(this,void 0,void 0,(function(){var e,t,r=this;return d(this,(function(o){return 0===(e=atom.project.getPaths()).length?[2,q("Editor has no projects")]:(t=x("dependencyPaths"))&&t.length?(e.map((function(e){e.startsWith("atom://")||t.map((function(t){return p(r,void 0,void 0,(function(){var r;return d(this,(function(o){return r=n.resolve(e,t),F({name:"`"+t+"`",path:r}),[2]}))}))}))})),[2]):[2,q("No dependency folders specified in package configuration")]}))}))}()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:resources-folder":function(){return function(){return p(this,void 0,void 0,(function(){return d(this,(function(e){return F({name:"Resources Folder",path:atom.commandInstaller.getResourcesDirectory()}),[2]}))}))}()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-open-files":function(){return function(){return p(this,void 0,void 0,(function(){var e;return d(this,(function(t){return(e=atom.workspace.getPaneItems()).length?e.map((function(e){X(e)})):q("No active files"),[2]}))}))}()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-file":function(){return X()}})),[2]}))}))},deactivate:function(){v("[browse] Deactivating package"),this.subscriptions&&this.subscriptions.dispose()},provideBrowse:function(){return v("[browse] Providing service"),J}};module.exports=Y;
//# sourceMappingURL=browse.js.map
