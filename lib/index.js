'use strict';

var path = require('path');
var fs = require('fs');
var os = require('os');
var util = require('util');
var electron = require('electron');
var child_process = require('child_process');
var atom$1 = require('atom');

var Ie=Object.create;var D=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var je=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Ee=Object.prototype.hasOwnProperty;var h=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var l=(e,t)=>()=>(e&&(t=e(e=0)),t);var w=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),d=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0});},Oe=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of je(t))!Ee.call(e,i)&&i!==r&&D(e,i,{get:()=>t[i],enumerable:!(s=Ce(t,i))||s.enumerable});return e};var Te=(e,t,r)=>(r=e!=null?Ie(Me(e)):{},Oe(!e||!e.__esModule?D(r,"default",{value:e,enumerable:!0}):r,e));var b,$=l(()=>{b="browse";});var z,B=l(()=>{z=class{name;styleSheet;constructor(e,t={}){if(typeof e!="string")throw new TypeError(`DeveloperConsole: name must be a string, got "${typeof e}"`);this.name=e,this.styleSheet=`
      background-color: ${t.backgroundColor||"darkgrey"};
      border-radius: 2px;
      color: ${t.color||"white"};
      line-height: 1.5;
      padding: 1px 4px;
      text-shadow: 0 1px 0px rgba(0, 0, 0, 0.2);
    `;}__console__(e,...t){atom!=null&&atom.inDevMode()&&(t.unshift(`%c${this.name}%c`,this.styleSheet,""),globalThis.console[e](...t));}debug(...e){this.__console__("debug",...e);}error(...e){this.__console__("error",...e);}info(...e){this.__console__("info",...e);}log(...e){this.__console__("log",...e);}trace(...e){this.__console__("trace",...e);}warn(...e){this.__console__("warn",...e);}};});var c,P=l(()=>{$();B();c=new z(b,{backgroundColor:"mediumseagreen"});});var p={};d(p,{fileExists:()=>U,folderExists:()=>W,getAppName:()=>He,getConfig:()=>f,getPackagesDirs:()=>Ke,info:()=>x,isDirectory:()=>Ue,isFile:()=>We,showFolder:()=>Qe,showInFolder:()=>Ge,warn:()=>Je});async function U(e){try{await fs.promises.access(e,fs.constants.F_OK);}catch{return c.warn(`Skipping '${e}' \u2013 not found`),!1}return !0}async function Ue(e){let t;try{t=await fs.promises.lstat(e);}catch(r){return c.error(r),!1}return t.isDirectory()}async function We(e){let t;try{t=await fs.promises.lstat(e);}catch(r){return c.error(r),!1}return t.isFile()}async function W(e){let t;try{t=await fs.promises.stat(e);}catch{return c.warn(`Skipping '${e}' \u2013 not found`),!1}return t.isDirectory()}async function Qe(e){var s,i,o,n;let t=typeof e=="string"?e:e.path;if(!t.length||!await W(t))return;let r=f("customFileManager.fullPath");if(r){let a=f("customFileManager.openArgs");if(a.length>0)if(a.includes("%path%")){let u=a.indexOf("%path%");a[u]=a[u].replace("%path%",t);}else a.push(t);else a=[t];typeof e!="string"&&!(e!=null&&e.silent)&&((s=e==null?void 0:e.message)!=null&&s.length)&&((i=e==null?void 0:e.name)!=null&&i.length)&&x(e.message?String(e.message):`Opening '${e.name}' in custom file manager`),R(r,a,{});}else {typeof e!="string"&&!(e!=null&&e.silent)&&((o=e==null?void 0:e.message)!=null&&o.length)&&((n=e==null?void 0:e.name)!=null&&n.length)&&x(e.message?String(e.message):`Opening '${e.name}' in ${H()}`);try{await electron.shell.openPath(t);}catch{electron.shell.openItem&&electron.shell.openItem(t);}}}async function Ge(e){var s,i;let t=typeof e=="string"?e:e.path;if(!t.length||!await U(t))return;let r=f("customFileManager.fullPath");if(r){let o=f("customFileManager.revealArgs");if(o.length>0)if(o.includes("%path%")){let n=o.indexOf("%path%");o[n]=o[n].replace("%path%",t);}else o.push(t);else o=[t];typeof e!="string"&&!(e!=null&&e.silent)&&((s=e==null?void 0:e.message)!=null&&s.length)&&x(e.message?String(e.message):`Revealing \`${path.basename(t)}\` in custom file manager`),R(r,o,{});}else typeof e!="string"&&!(e!=null&&e.silent)&&((i=e==null?void 0:e.message)!=null&&i.length)&&x(e.message?String(e.message):`Revealing \`${path.basename(t)}\` in ${H()}`),electron.shell.showItemInFolder(t);}function x(e,t=!1){f("notify")==="all"&&atom.notifications.addInfo(`**${b}** ${e}`,{dismissable:t,icon:"check"}),c.info(`${e}`);}function Je(e,t=!1){f("notify")!=="none"&&atom.notifications.addWarning(`**${b}** ${e}`,{dismissable:t}),f("beep")&&atom.beep(),c.warn(`${e}`);}var R,He,f,Ke,H,m=l(()=>{P();$();R=util.promisify(child_process.spawn);He=()=>atom.getAppName().split(" ")[0],f=(e="")=>atom.config.get(`browse.${e}`),Ke=()=>atom.packages.getPackageDirPaths().filter(t=>!t.includes("app.asar")),H=()=>{switch(os.platform()){case"darwin":return "Finder";case"win32":return "Explorer";default:return "file manager"}};});var J={};d(J,{apmFolder:()=>Ze});async function Ze(){let{showFolder:e}=await Promise.resolve().then(()=>(m(),p)),t=path.dirname(atom.config.getUserConfigPath()),r=path.resolve(t,".apm");e({name:".apm Folder",path:r});}var V=l(()=>{});var Y={};d(Y,{appDataFolder:()=>tt});async function tt(){let{getAppName:e,showFolder:t}=await Promise.resolve().then(()=>(m(),p)),r=e(),s;switch(os.platform()){case"darwin":s=path.resolve(os.homedir(),"Library","Application Support",r);break;case"win32":s=process.env.APPDATA?path.resolve(process.env.APPDATA,r):"";break;default:s=path.resolve(os.homedir(),".config",r);break}t({name:"App Data Folder",path:s});}var Z=l(()=>{});var te=w((Kt,ee)=>{var I=class{constructor(t){this.value=t,this.next=void 0;}},C=class{constructor(){this.clear();}enqueue(t){let r=new I(t);this._head?(this._tail.next=r,this._tail=r):(this._head=r,this._tail=r),this._size++;}dequeue(){let t=this._head;if(t)return this._head=this._head.next,this._size--,t.value}clear(){this._head=void 0,this._tail=void 0,this._size=0;}get size(){return this._size}*[Symbol.iterator](){let t=this._head;for(;t;)yield t.value,t=t.next;}};ee.exports=C;});var se=w((Qt,re)=>{var rt=te(),st=e=>{if(!((Number.isInteger(e)||e===1/0)&&e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let t=new rt,r=0,s=()=>{r--,t.size>0&&t.dequeue()();},i=async(a,u,...v)=>{r++;let N=(async()=>a(...v))();u(N);try{await N;}catch{}s();},o=(a,u,...v)=>{t.enqueue(i.bind(null,a,u,...v)),(async()=>(await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()))();},n=(a,...u)=>new Promise(v=>{o(a,v,...u);});return Object.defineProperties(n,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear();}}}),n};re.exports=st;});var ae=w((Gt,ie)=>{var ne=se(),_=class extends Error{constructor(t){super(),this.value=t;}},nt=async(e,t)=>t(await e),it=async e=>{let t=await Promise.all(e);if(t[1]===!0)throw new _(t[0]);return !1},at=async(e,t,r)=>{r={concurrency:1/0,preserveOrder:!0,...r};let s=ne(r.concurrency),i=[...e].map(n=>[n,s(nt,n,t)]),o=ne(r.preserveOrder?1:1/0);try{await Promise.all(i.map(n=>o(it,n)));}catch(n){if(n instanceof _)return n.value;throw n}};ie.exports=at;});var de=w((Jt,j)=>{var oe=h("path"),A=h("fs"),{promisify:ce}=h("util"),ot=ae(),ct=ce(A.stat),lt=ce(A.lstat),le={directory:"isDirectory",file:"isFile"};function pe({type:e}){if(!(e in le))throw new Error(`Invalid type specified: ${e}`)}var me=(e,t)=>e===void 0||t[le[e]]();j.exports=async(e,t)=>{t={cwd:process.cwd(),type:"file",allowSymlinks:!0,...t},pe(t);let r=t.allowSymlinks?ct:lt;return ot(e,async s=>{try{let i=await r(oe.resolve(t.cwd,s));return me(t.type,i)}catch{return !1}},t)};j.exports.sync=(e,t)=>{t={cwd:process.cwd(),allowSymlinks:!0,type:"file",...t},pe(t);let r=t.allowSymlinks?A.statSync:A.lstatSync;for(let s of e)try{let i=r(oe.resolve(t.cwd,s));if(me(t.type,i))return s}catch{}};});var fe=w((Vt,M)=>{var ue=h("fs"),{promisify:pt}=h("util"),mt=pt(ue.access);M.exports=async e=>{try{return await mt(e),!0}catch{return !1}};M.exports.sync=e=>{try{return ue.accessSync(e),!0}catch{return !1}};});var he=w((Xt,y)=>{var g=h("path"),S=de(),ge=fe(),E=Symbol("findUp.stop");y.exports=async(e,t={})=>{let r=g.resolve(t.cwd||""),{root:s}=g.parse(r),i=[].concat(e),o=async n=>{if(typeof e!="function")return S(i,n);let a=await e(n.cwd);return typeof a=="string"?S([a],n):a};for(;;){let n=await o({...t,cwd:r});if(n===E)return;if(n)return g.resolve(r,n);if(r===s)return;r=g.dirname(r);}};y.exports.sync=(e,t={})=>{let r=g.resolve(t.cwd||""),{root:s}=g.parse(r),i=[].concat(e),o=n=>{if(typeof e!="function")return S.sync(i,n);let a=e(n.cwd);return typeof a=="string"?S.sync([a],n):a};for(;;){let n=o({...t,cwd:r});if(n===E)return;if(n)return g.resolve(r,n);if(r===s)return;r=g.dirname(r);}};y.exports.exists=ge;y.exports.sync.exists=ge.sync;y.exports.stop=E;});var ye={};d(ye,{appFolder:()=>ft});async function ft(){let{getConfig:e,showFolder:t}=await Promise.resolve().then(()=>(m(),p)),r=await Promise.resolve().then(()=>Te(he())),s=path.dirname(path.resolve(process.execPath)),i;if(os.platform()==="darwin"&&e("openAppPackage")){let o=r.sync("Resources",{cwd:s,type:"directory"});i=o?path.dirname(o):s;}else i=s;t({name:"Application Folder",path:i});}var ve=l(()=>{});var be={};d(be,{configFolder:()=>ht});async function ht(){let{showFolder:e}=await Promise.resolve().then(()=>(m(),p)),t=path.dirname(atom.config.getUserConfigPath());e({name:"Configuration Folder",path:t});}var xe=l(()=>{});var Pe={};d(Pe,{packagesFolder:()=>wt});async function wt(){let{getPackagesDirs:e,showFolder:t}=await Promise.resolve().then(()=>(m(),p));e().map(s=>{t({name:"Packages Folder",path:s});});}var ke=l(()=>{});var Fe={};d(Fe,{projectFolders:()=>yt});async function yt(){let{showFolder:e,warn:t}=await Promise.resolve().then(()=>(m(),p)),r=atom.project.getPaths();if(r.length===0)return t("Editor has no projects");r.map(s=>{s.startsWith("atom://")||e({name:"Project Folder",path:s});});}var _e=l(()=>{});var Ae={};d(Ae,{projectDependencies:()=>bt});async function bt(){let{getConfig:e,showFolder:t,warn:r}=await Promise.resolve().then(()=>(m(),p)),s=atom.project.getPaths();if(s.length===0)return r("Editor has no projects");let i=e("dependencyPaths");if(!i||!i.length)return r("No dependency folders specified in package configuration");s.map(o=>{o.startsWith("atom://")||i.map(async n=>{let a=path.resolve(o,n);t({name:`\`${n}\``,path:a});});});}var Se=l(()=>{});var De={};d(De,{resourcesFolder:()=>xt});async function xt(){let{showFolder:e}=await Promise.resolve().then(()=>(m(),p)),t=atom.commandInstaller.getResourcesDirectory();e({name:"Resources Folder",path:t});}var $e=l(()=>{});var O={};d(O,{revealFile:()=>qe,revealFiles:()=>Pt});async function qe(e){let{showInFolder:t,warn:r}=await Promise.resolve().then(()=>(m(),p)),s=e||atom.workspace.getActiveTextEditor()||atom.workspace.getActivePaneItem();if(s&&(s.constructor.name==="TextEditor"||s.constructor.name==="ImageEditor")){let i=s.buffer.file?s.buffer.file.path:"";i?t({path:i}):r("File hasn't been saved yet");}else r("Active pane is not an editor");}async function Pt(){let{warn:e}=await Promise.resolve().then(()=>(m(),p)),t=atom.workspace.getPaneItems();t.length?t.map(r=>{qe(r);}):e("No active files");}var T=l(()=>{});P();async function K(e){let{isDirectory:t,isFile:r,showFolder:s,showInFolder:i}=await Promise.resolve().then(()=>(m(),p));typeof e=="string"?(c.log("Auto-handle string input"),e={action:await r(e)?"reveal":"open",target:e}):e!=null&&e.action&&["reveal","open"].includes(e==null?void 0:e.action)&&c.warn("payload.action is deprecated and can be omitted"),(Array.isArray(e.target)?e.target:[e.target]).map(async n=>{if(typeof n!="string"&&c.warn(`Skipping: target path is of type ${typeof n}, should be string`),e.action==="reveal"||await r(n))i({path:n,message:e.message,silent:e.silent});else if(e.action==="open"||await t(n)){let{basename:a}=await import('path');s({name:a(n),path:n,message:e.message,silent:e.silent});}else e.action&&c.warn(`Action '${e.action}' is not supported`);});}P();var Ve=()=>{if(os.platform()==="darwin")return os.platform()==="darwin"?{title:"Open App Package",description:`Specify whether *Browse: Application Folder* opens the \`${atom.getAppName()}.app\` package or the executable that started the Node.js process (i.e. \`Atom Helper\`)`,type:"boolean",default:!0,order:3}:{}},G={notify:{title:"Notifications",description:"Specify which types of notifications to display",type:"string",enum:[{value:"none",description:"None"},{value:"warnings",description:"Warnings Only"},{value:"all",description:"All Notifications"}],default:"all",order:1},dependencyPaths:{title:"Dependency Paths",description:"Specify dependency folders that can be opened using the *Browse: Dependency Folders* command",type:"array",default:["bower_components","node_modules","vendor"],items:{type:["string"]},order:2},beep:{title:"Beep on error",description:"Play beep sound when errors occur",type:"boolean",default:!0,order:3},openAppPackage:Ve(),customFileManager:{title:"Custom File Manager Options",type:"object",order:5,properties:{fullPath:{title:"Full Path",description:"Specify the full path to a custom file manager",type:"string",default:"",order:1},openArgs:{title:"Open Arguments",description:"Specify custom arguments to open a folder. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:2},revealArgs:{title:"Reveal Arguments",description:"Specify custom arguments to reveal a file. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:3}}}};var ar={config:G,subscriptions:new atom$1.CompositeDisposable,async activate(){c.log("Activating package"),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:.apm-folder":async()=>{let{apmFolder:e}=await Promise.resolve().then(()=>(V(),J));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:app-data-folder":async()=>{let{appDataFolder:e}=await Promise.resolve().then(()=>(Z(),Y));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:application-folder":async()=>{let{appFolder:e}=await Promise.resolve().then(()=>(ve(),ye));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:configuration-folder":async()=>{let{configFolder:e}=await Promise.resolve().then(()=>(xe(),be));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:packages-folder":async()=>{let{packagesFolder:e}=await Promise.resolve().then(()=>(ke(),Pe));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-folders":async()=>{let{projectFolders:e}=await Promise.resolve().then(()=>(_e(),Fe));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-dependencies":async()=>{let{projectDependencies:e}=await Promise.resolve().then(()=>(Se(),Ae));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:resources-folder":async()=>{let{resourcesFolder:e}=await Promise.resolve().then(()=>($e(),De));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-open-files":async()=>{let{revealFiles:e}=await Promise.resolve().then(()=>(T(),O));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-file":async()=>{let{revealFile:e}=await Promise.resolve().then(()=>(T(),O));e();}}));},deactivate(){var e;c.log("Deactivating package"),(e=this.subscriptions)==null||e.dispose();},provideBrowse(){return c.log("Providing service"),K}};

module.exports = ar;
