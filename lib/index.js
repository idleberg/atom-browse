'use strict';

var path = require('path');
var fs = require('fs');
var os = require('os');
var util = require('util');
var electron = require('electron');
var child_process = require('child_process');
var atom$1 = require('atom');

var $e=Object.create;var D=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Ce=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var h=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var p=(e,t)=>()=>(e&&(t=e(e=0)),t);var w=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),u=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0});},Me=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Ie(t))!je.call(e,a)&&a!==r&&D(e,a,{get:()=>t[a],enumerable:!(n=qe(t,a))||n.enumerable});return e};var Ee=(e,t,r)=>(r=e!=null?$e(Ce(e)):{},Me(!e||!e.__esModule?D(r,"default",{value:e,enumerable:!0}):r,e));var b,$=p(()=>{b="browse";});var z,B=p(()=>{z=class{name;styleSheet;constructor(e,t={}){if(typeof e!="string")throw new TypeError(`DeveloperConsole: name must be a string, got "${typeof e}"`);this.name=e,this.styleSheet=`
      background-color: ${t.backgroundColor||"darkgrey"};
      border-radius: 2px;
      color: ${t.color||"white"};
      line-height: 1.5;
      padding: 1px 4px;
      text-shadow: 0 1px 0px rgba(0, 0, 0, 0.2);
    `;}__console__(e,...t){atom!=null&&atom.inDevMode()&&(t.unshift(`%c${this.name}%c`,this.styleSheet,""),globalThis.console[e](...t));}debug(...e){this.__console__("debug",...e);}error(...e){this.__console__("error",...e);}info(...e){this.__console__("info",...e);}log(...e){this.__console__("log",...e);}trace(...e){this.__console__("trace",...e);}warn(...e){this.__console__("warn",...e);}};});var c,P=p(()=>{$();B();c=new z(b,{backgroundColor:"mediumseagreen"});});var m={};u(m,{fileExists:()=>U,folderExists:()=>W,getAppName:()=>q,getConfig:()=>f,getPackagesDirs:()=>Ue,info:()=>x,isDirectory:()=>Le,isFile:()=>Re,showFolder:()=>We,showInFolder:()=>He,warn:()=>Ke});async function U(e){try{await fs.promises.access(e,fs.constants.F_OK);}catch{return c.warn(`Skipping '${e}' \u2013 not found`),!1}return !0}async function Le(e){let t;try{t=await fs.promises.lstat(e);}catch(r){return c.error(r),!1}return t.isDirectory()}async function Re(e){let t;try{t=await fs.promises.lstat(e);}catch(r){return c.error(r),!1}return t.isFile()}async function W(e){let t;try{t=await fs.promises.stat(e);}catch{return c.warn(`Skipping '${e}' \u2013 not found`),!1}return t.isDirectory()}async function We(e){var n,a,o,s;let t=typeof e=="string"?e:e.path;if(!t.length||!await W(t))return;let r=f("customFileManager.fullPath");if(r){let i=f("customFileManager.openArgs");if(i.length>0)if(i.includes("%path%")){let l=i.indexOf("%path%");i[l]=i[l].replace("%path%",t);}else i.push(t);else i=[t];typeof e!="string"&&!(e!=null&&e.silent)&&((n=e==null?void 0:e.message)!=null&&n.length)&&((a=e==null?void 0:e.name)!=null&&a.length)&&x(e.message?String(e.message):`Opening '${e.name}' in custom file manager`),R(r,i,{});}else {typeof e!="string"&&!(e!=null&&e.silent)&&((o=e==null?void 0:e.message)!=null&&o.length)&&((s=e==null?void 0:e.name)!=null&&s.length)&&x(e.message?String(e.message):`Opening '${e.name}' in ${H()}`);try{await electron.shell.openPath(t);}catch{electron.shell.openItem&&electron.shell.openItem(t);}}}async function He(e){var n,a;let t=typeof e=="string"?e:e.path;if(!t.length||!await U(t))return;let r=f("customFileManager.fullPath");if(r){let o=f("customFileManager.revealArgs");if(o.length>0)if(o.includes("%path%")){let s=o.indexOf("%path%");o[s]=o[s].replace("%path%",t);}else o.push(t);else o=[t];typeof e!="string"&&!(e!=null&&e.silent)&&((n=e==null?void 0:e.message)!=null&&n.length)&&x(e.message?String(e.message):`Revealing \`${path.basename(t)}\` in custom file manager`),R(r,o,{});}else typeof e!="string"&&!(e!=null&&e.silent)&&((a=e==null?void 0:e.message)!=null&&a.length)&&x(e.message?String(e.message):`Revealing \`${path.basename(t)}\` in ${H()}`),electron.shell.showItemInFolder(t);}function x(e,t=!1){f("notify")==="all"&&atom.notifications.addInfo(`**${b}** ${e}`,{dismissable:t,icon:"check"}),c.info(`${e}`);}function Ke(e,t=!1){f("notify")!=="none"&&atom.notifications.addWarning(`**${b}** ${e}`,{dismissable:t}),f("beep")&&atom.beep(),c.warn(`${e}`);}var R,q,f,Ue,H,d=p(()=>{P();$();R=util.promisify(child_process.spawn);q=()=>atom.getAppName().split(" ")[0],f=(e="")=>atom.config.get(`browse.${e}`),Ue=()=>atom.packages.getPackageDirPaths().filter(t=>!t.includes("app.asar")),H=()=>{switch(os.platform()){case"darwin":return "Finder";case"win32":return "Explorer";default:return "file manager"}};});var J={};u(J,{apmFolder:()=>Ge});async function Ge(){let{dirname:e,resolve:t}=await import('path'),{showFolder:r}=await Promise.resolve().then(()=>(d(),m)),n=e(atom.config.getUserConfigPath()),a=t(n,".apm");r({name:".apm Folder",path:a});}var V=p(()=>{});var X={};u(X,{appDataFolder:()=>Je});async function Je(){let{homedir:e,platform:t}=await import('os'),{resolve:r}=await import('path'),{showFolder:n}=await Promise.resolve().then(()=>(d(),m)),a=q(),o;switch(t()){case"darwin":o=r(e(),"Library","Application Support",a);break;case"win32":o=process.env.APPDATA?r(process.env.APPDATA,a):"";break;default:o=r(e(),".config",a);break}n({name:"App Data Folder",path:o});}var Y=p(()=>{d();});var ee=w((Mt,Z)=>{var I=class{constructor(t){this.value=t,this.next=void 0;}},C=class{constructor(){this.clear();}enqueue(t){let r=new I(t);this._head?(this._tail.next=r,this._tail=r):(this._head=r,this._tail=r),this._size++;}dequeue(){let t=this._head;if(t)return this._head=this._head.next,this._size--,t.value}clear(){this._head=void 0,this._tail=void 0,this._size=0;}get size(){return this._size}*[Symbol.iterator](){let t=this._head;for(;t;)yield t.value,t=t.next;}};Z.exports=C;});var re=w((Et,te)=>{var Ve=ee(),Xe=e=>{if(!((Number.isInteger(e)||e===1/0)&&e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let t=new Ve,r=0,n=()=>{r--,t.size>0&&t.dequeue()();},a=async(i,l,...v)=>{r++;let N=(async()=>i(...v))();l(N);try{await N;}catch{}n();},o=(i,l,...v)=>{t.enqueue(a.bind(null,i,l,...v)),(async()=>(await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()))();},s=(i,...l)=>new Promise(v=>{o(i,v,...l);});return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear();}}}),s};te.exports=Xe;});var ae=w((Ot,ne)=>{var se=re(),_=class extends Error{constructor(t){super(),this.value=t;}},Ye=async(e,t)=>t(await e),Ze=async e=>{let t=await Promise.all(e);if(t[1]===!0)throw new _(t[0]);return !1},et=async(e,t,r)=>{r={concurrency:1/0,preserveOrder:!0,...r};let n=se(r.concurrency),a=[...e].map(s=>[s,n(Ye,s,t)]),o=se(r.preserveOrder?1:1/0);try{await Promise.all(a.map(s=>o(Ze,s)));}catch(s){if(s instanceof _)return s.value;throw s}};ne.exports=et;});var de=w((Tt,j)=>{var ie=h("path"),A=h("fs"),{promisify:oe}=h("util"),tt=ae(),rt=oe(A.stat),st=oe(A.lstat),ce={directory:"isDirectory",file:"isFile"};function le({type:e}){if(!(e in ce))throw new Error(`Invalid type specified: ${e}`)}var pe=(e,t)=>e===void 0||t[ce[e]]();j.exports=async(e,t)=>{t={cwd:process.cwd(),type:"file",allowSymlinks:!0,...t},le(t);let r=t.allowSymlinks?rt:st;return tt(e,async n=>{try{let a=await r(ie.resolve(t.cwd,n));return pe(t.type,a)}catch{return !1}},t)};j.exports.sync=(e,t)=>{t={cwd:process.cwd(),allowSymlinks:!0,type:"file",...t},le(t);let r=t.allowSymlinks?A.statSync:A.lstatSync;for(let n of e)try{let a=r(ie.resolve(t.cwd,n));if(pe(t.type,a))return n}catch{}};});var ue=w((Nt,M)=>{var me=h("fs"),{promisify:nt}=h("util"),at=nt(me.access);M.exports=async e=>{try{return await at(e),!0}catch{return !1}};M.exports.sync=e=>{try{return me.accessSync(e),!0}catch{return !1}};});var ge=w((zt,y)=>{var g=h("path"),S=de(),fe=ue(),E=Symbol("findUp.stop");y.exports=async(e,t={})=>{let r=g.resolve(t.cwd||""),{root:n}=g.parse(r),a=[].concat(e),o=async s=>{if(typeof e!="function")return S(a,s);let i=await e(s.cwd);return typeof i=="string"?S([i],s):i};for(;;){let s=await o({...t,cwd:r});if(s===E)return;if(s)return g.resolve(r,s);if(r===n)return;r=g.dirname(r);}};y.exports.sync=(e,t={})=>{let r=g.resolve(t.cwd||""),{root:n}=g.parse(r),a=[].concat(e),o=s=>{if(typeof e!="function")return S.sync(a,s);let i=e(s.cwd);return typeof i=="string"?S.sync([i],s):i};for(;;){let s=o({...t,cwd:r});if(s===E)return;if(s)return g.resolve(r,s);if(r===n)return;r=g.dirname(r);}};y.exports.exists=fe;y.exports.sync.exists=fe.sync;y.exports.stop=E;});var he={};u(he,{appFolder:()=>it});async function it(){let{dirname:e,resolve:t}=await import('path'),{getConfig:r,showFolder:n}=await Promise.resolve().then(()=>(d(),m)),{platform:a}=await import('os'),o=await Promise.resolve().then(()=>Ee(ge())),s=e(t(process.execPath)),i;if(a()==="darwin"&&r("openAppPackage")){let l=o.sync("Resources",{cwd:s,type:"directory"});i=l?e(l):s;}else i=s;n({name:"Application Folder",path:i});}var we=p(()=>{});var ye={};u(ye,{configFolder:()=>ot});async function ot(){let{dirname:e}=await import('path'),{showFolder:t}=await Promise.resolve().then(()=>(d(),m)),r=e(atom.config.getUserConfigPath());t({name:"Configuration Folder",path:r});}var ve=p(()=>{});var be={};u(be,{packagesFolder:()=>ct});async function ct(){let{getPackagesDirs:e,showFolder:t}=await Promise.resolve().then(()=>(d(),m));e().map(n=>{t({name:"Packages Folder",path:n});});}var xe=p(()=>{});var Pe={};u(Pe,{projectFolders:()=>lt});async function lt(){let{showFolder:e,warn:t}=await Promise.resolve().then(()=>(d(),m)),r=atom.project.getPaths();if(r.length===0)return t("Editor has no projects");r.map(n=>{n.startsWith("atom://")||e({name:"Project Folder",path:n});});}var ke=p(()=>{});var Fe={};u(Fe,{projectDependencies:()=>pt});async function pt(){let{getConfig:e,showFolder:t,warn:r}=await Promise.resolve().then(()=>(d(),m)),{resolve:n}=await import('path'),a=atom.project.getPaths();if(a.length===0)return r("Editor has no projects");let o=e("dependencyPaths");if(!o||!o.length)return r("No dependency folders specified in package configuration");a.map(s=>{s.startsWith("atom://")||o.map(async i=>{let l=n(s,i);t({name:`\`${i}\``,path:l});});});}var _e=p(()=>{});var Ae={};u(Ae,{resourcesFolder:()=>dt});async function dt(){let{showFolder:e}=await Promise.resolve().then(()=>(d(),m)),t=atom.commandInstaller.getResourcesDirectory();e({name:"Resources Folder",path:t});}var Se=p(()=>{});var O={};u(O,{revealFile:()=>De,revealFiles:()=>mt});async function De(e){let{showInFolder:t,warn:r}=await Promise.resolve().then(()=>(d(),m)),n=e||atom.workspace.getActiveTextEditor()||atom.workspace.getActivePaneItem();if(n&&(n.constructor.name==="TextEditor"||n.constructor.name==="ImageEditor")){let a=n.buffer.file?n.buffer.file.path:"";a?t({path:a}):r("File hasn't been saved yet");}else r("Active pane is not an editor");}async function mt(){let{warn:e}=await Promise.resolve().then(()=>(d(),m)),t=atom.workspace.getPaneItems();t.length?t.map(r=>{De(r);}):e("No active files");}var T=p(()=>{});P();async function K(e){let{isDirectory:t,isFile:r,showFolder:n,showInFolder:a}=await Promise.resolve().then(()=>(d(),m));typeof e=="string"?(c.log("Auto-handle string input"),e={action:await r(e)?"reveal":"open",target:e}):e!=null&&e.action&&["reveal","open"].includes(e==null?void 0:e.action)&&c.warn("payload.action is deprecated and can be omitted"),(Array.isArray(e.target)?e.target:[e.target]).map(async s=>{if(typeof s!="string"&&c.warn(`Skipping: target path is of type ${typeof s}, should be string`),e.action==="reveal"||await r(s))a({path:s,message:e.message,silent:e.silent});else if(e.action==="open"||await t(s)){let{basename:i}=await import('path');n({name:i(s),path:s,message:e.message,silent:e.silent});}else e.action&&c.warn(`Action '${e.action}' is not supported`);});}P();var Qe=()=>{if(os.platform()==="darwin")return os.platform()==="darwin"?{title:"Open App Package",description:`Specify whether *Browse: Application Folder* opens the \`${atom.getAppName()}.app\` package or the executable that started the Node.js process (i.e. \`Atom Helper\`)`,type:"boolean",default:!0,order:3}:{}},G={notify:{title:"Notifications",description:"Specify which types of notifications to display",type:"string",enum:[{value:"none",description:"None"},{value:"warnings",description:"Warnings Only"},{value:"all",description:"All Notifications"}],default:"all",order:1},dependencyPaths:{title:"Dependency Paths",description:"Specify dependency folders that can be opened using the *Browse: Dependency Folders* command",type:"array",default:["bower_components","node_modules","vendor"],items:{type:["string"]},order:2},beep:{title:"Beep on error",description:"Play beep sound when errors occur",type:"boolean",default:!0,order:3},openAppPackage:Qe(),customFileManager:{title:"Custom File Manager Options",type:"object",order:5,properties:{fullPath:{title:"Full Path",description:"Specify the full path to a custom file manager",type:"string",default:"",order:1},openArgs:{title:"Open Arguments",description:"Specify custom arguments to open a folder. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:2},revealArgs:{title:"Reveal Arguments",description:"Specify custom arguments to reveal a file. The use of the `%path%` placeholder is optional.",type:"array",default:[],items:{type:["string","integer"]},order:3}}}};var Wt={config:G,subscriptions:new atom$1.CompositeDisposable,async activate(){c.log("Activating package"),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:.apm-folder":async()=>{let{apmFolder:e}=await Promise.resolve().then(()=>(V(),J));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:app-data-folder":async()=>{let{appDataFolder:e}=await Promise.resolve().then(()=>(Y(),X));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:application-folder":async()=>{let{appFolder:e}=await Promise.resolve().then(()=>(we(),he));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:configuration-folder":async()=>{let{configFolder:e}=await Promise.resolve().then(()=>(ve(),ye));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:packages-folder":async()=>{let{packagesFolder:e}=await Promise.resolve().then(()=>(xe(),be));await e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-folders":async()=>{let{projectFolders:e}=await Promise.resolve().then(()=>(ke(),Pe));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:project-dependencies":async()=>{let{projectDependencies:e}=await Promise.resolve().then(()=>(_e(),Fe));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:resources-folder":async()=>{let{resourcesFolder:e}=await Promise.resolve().then(()=>(Se(),Ae));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-open-files":async()=>{let{revealFiles:e}=await Promise.resolve().then(()=>(T(),O));e();}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"browse:reveal-file":async()=>{let{revealFile:e}=await Promise.resolve().then(()=>(T(),O));e();}}));},deactivate(){var e;c.log("Deactivating package"),(e=this.subscriptions)==null||e.dispose();},provideBrowse(){return c.log("Providing service"),K}};

module.exports = Wt;
